package {	import flash.display.*;	import flash.events.*;	import flash.utils.*;	import flash.filters.*;	import flash.geom.*;	import fl.controls.Slider;	import fl.events.SliderEvent;	import fl.controls.ColorPicker;	import fl.events.ColorPickerEvent;		import org.papervision3d.scenes.Scene3D;	import org.papervision3d.objects.DisplayObject3D;	import org.papervision3d.objects.primitives.*;	import org.papervision3d.cameras.*;	import org.papervision3d.view.Viewport3D;	import org.papervision3d.render.BasicRenderEngine;	import org.papervision3d.materials.*;	import org.papervision3d.materials.utils.MaterialsList;	import org.papervision3d.view.layer.*;	[SWF(width="1024", height="568", backgroundColor="#000000", frameRate="50")]	public class Main extends Sprite {			private var scene:Scene3D;		private var camera:Camera3D;		private var viewport:Viewport3D;		private var renderer:BasicRenderEngine;		private var container:DisplayObject3D;				private var viewportLayerForCube:ViewportLayer;  		private var viewportLayerForPlane:ViewportLayer;  				private var stageW:Number;		private var stageH:Number;		private var vpX:Number;		private var vpY:Number;		private var cameraInfo:CameraInfo;		private var sliders:Sliders;		private var glowFilter:GlowFilter;		private var blurFilter:BlurFilter; 				private var time:Number = 0;		private var secondTime:Number = 0;		private var previousSecondTime:Number = 0;		private var frameNum:Number = 0;		private var fps:String = "...";				private var myGlowColorPicker:ColorPicker;		private var myGlowAlphaSlider:Slider;		private var myGlowBlurXSlider:Slider;		private var myGlowBlurYSlider:Slider;		private var myGlowStrengthSlider:Slider;		private var myBlurBlurXSlider:Slider;		private var myBlurBlurYSlider:Slider;				private var gColor:uint = 0x9999FF;		private var gAlpha:Number = 0.8;		private var gBlurX:Number = 120;		private var gBlurY:Number = 120;		private var gStrength:Number = 2;		private var bBlurX:Number = 60;		private var bBlurY:Number = 60;		private var gColorHex:String;				private var isDragging:Boolean;		private var mouseDownX:Number;		private var mouseDownY:Number;		private var cameraPitch:Number;		private var cameraYaw:Number;		private var onSliders:Boolean = false;				// -- SWC書き出しのためのインスタンス化 Start -- //		private var m_1:Back = new Back();		private var m_2:Bottom = new Bottom();		private var m_3:Front = new Front();		private var m_4:Left = new Left();		private var m_5:Right = new Right();		private var m_6:Top = new Top();		// -- SWC書き出しのためのインスタンス化 End -- //				public function Main () {						init();		}			private function init():void {			setStage();			setScene();			setCamera();			setDO3D();			setSliders();			setCameraInfo();						addEventListener(Event.ENTER_FRAME, onEnterFrameHandler);			stage.addEventListener(Event.RESIZE, onStageResizeHandler);			stage.addEventListener(MouseEvent.MOUSE_DOWN, onMouseDownHandler);			stage.addEventListener(MouseEvent.MOUSE_MOVE, onMouseMoveHandler);			stage.addEventListener(MouseEvent.MOUSE_UP, onMouseUpHandler);						sliders.addEventListener(MouseEvent.MOUSE_OVER, onMouseOverSliders);			sliders.addEventListener(MouseEvent.MOUSE_OUT, onMouseOutSliders);		}				private function setStage():void {			stage.quality = StageQuality.MEDIUM;			stage.scaleMode = StageScaleMode.NO_SCALE;			stage.align = StageAlign.TOP_LEFT;			stageW = stage.stageWidth;			stageH = stage.stageHeight;			vpX = stageW / 2;			vpY = stageH / 2;		}				private function setCameraInfo():void {			cameraInfo = new CameraInfo();			addChild(cameraInfo);			stageW = stage.stageWidth;			stageH = stage.stageHeight;			vpX = stageW / 2;			vpY = stageH / 2;			cameraInfo.x = stageW;			cameraInfo.y = stageH;		}				private function setScene():void{			renderer = new BasicRenderEngine();			scene = new Scene3D();			viewport  = new Viewport3D(0, 0, true, true);			addChild(viewport);		}				private function setCamera():void {			camera = new Camera3D();			camera.x = 400;			camera.y = 600;			camera.z = -1000;			camera.zoom = 30;			camera.focus = 30;		}				private function setDO3D():void {			container = new DisplayObject3D();			scene.addChild(container);						var materialPlane:WireframeMaterial = new WireframeMaterial(0x666666, 1);			materialPlane.oneSide = false;			materialPlane.smooth = true;			var plane:Plane = new Plane(materialPlane, 1000, 1000, 8, 8);			container.addChild(plane);			plane.rotationX = -90;						var materialsList:MaterialsList = new MaterialsList({				front: new MovieAssetMaterial("Front", false ),				back: new MovieAssetMaterial("Back", false ),				right: new MovieAssetMaterial("Right", false ),				left: new MovieAssetMaterial("Left", false ),				top: new MovieAssetMaterial("Top", false ),				bottom: new MovieAssetMaterial("Bottom", false )			});						var cube:Cube = new Cube(materialsList, 200, 200, 200, 4, 4, 4);			cube.y = 200;			container.addChild(cube);			camera.target = cube;						viewportLayerForCube = cube.createViewportLayer(viewport, true);			viewportLayerForPlane = plane.createViewportLayer(viewport, true);						var cameraXfromTarget:Number = camera.x - camera.target.x;			var cameraYfromTarget:Number = camera.y - camera.target.y;			var cameraZfromTarget:Number = camera.z - camera.target.z;			cameraYaw = Math.atan2(cameraZfromTarget, cameraXfromTarget) * 180 / Math.PI;			cameraPitch = Math.atan2(-cameraZfromTarget, cameraYfromTarget) * 180 / Math.PI;		}				private function setSliders():void {			sliders = new Sliders();			addChild(sliders);						myGlowColorPicker = sliders.myGlowColorPicker;			myGlowAlphaSlider = sliders.myGlowAlphaSlider;			myGlowBlurXSlider = sliders.myGlowBlurXSlider;			myGlowBlurYSlider = sliders.myGlowBlurYSlider;			myGlowStrengthSlider = sliders.myGlowStrengthSlider;			myBlurBlurXSlider = sliders.myBlurBlurXSlider;			myBlurBlurYSlider = sliders.myBlurBlurYSlider;						myGlowColorPicker.selectedColor = gColor;			myGlowAlphaSlider.value = gAlpha;			myGlowBlurXSlider.value = gBlurX;			myGlowBlurYSlider.value = gBlurY;			myGlowStrengthSlider.value = gStrength;			myBlurBlurXSlider.value = bBlurX;			myBlurBlurYSlider.value = bBlurY;						myGlowColorPicker.addEventListener(ColorPickerEvent.CHANGE, myGlowColorPickerChangeHandler);			myGlowAlphaSlider.addEventListener(SliderEvent.THUMB_DRAG, myGlowAlphaSliderDragHandler);			myGlowBlurXSlider.addEventListener(SliderEvent.THUMB_DRAG, myGlowBlurXSliderDragHandler);			myGlowBlurYSlider.addEventListener(SliderEvent.THUMB_DRAG, myGlowBlurYSliderDragHandler);			myGlowStrengthSlider.addEventListener(SliderEvent.THUMB_DRAG, myGlowStrengthSliderDragHandler);			myBlurBlurXSlider.addEventListener(SliderEvent.THUMB_DRAG, myBlurBlurXSliderDragHandler);			myBlurBlurYSlider.addEventListener(SliderEvent.THUMB_DRAG, myBlurBlurYSliderDragHandler);					}				private function getFPS():void {			time = getTimer();			secondTime = time - previousSecondTime;			if(secondTime >= 1000) {				fps = frameNum.toString();				frameNum = 0;				previousSecondTime = time;			} else {				frameNum++;			}			cameraInfo.fpsText.text = fps+"FPS";			cameraInfo.cameraRotationX.text = camera.rotationX.toString();			cameraInfo.cameraRotationY.text = camera.rotationY.toString();			cameraInfo.cameraRotationZ.text = camera.rotationZ.toString();			cameraInfo.cameraX.text = camera.x.toString();			cameraInfo.cameraY.text = camera.y.toString();			cameraInfo.cameraZ.text = camera.z.toString();						gColorHex = "0x" + myGlowColorPicker.hexValue;			cameraInfo.gColor.text = gColorHex;			cameraInfo.gAlpha.text = gAlpha.toString();			cameraInfo.gBlurX.text = gBlurX.toString();			cameraInfo.gBlurY.text = gBlurY.toString();			cameraInfo.gStrength.text = gStrength.toString();			cameraInfo.bBlurX.text = bBlurX.toString();			cameraInfo.bBlurY.text = bBlurY.toString();		}				private function onEnterFrameHandler(event:Event):void {			glowFilter = new GlowFilter(gColor, gAlpha, gBlurX, gBlurY, gStrength);			blurFilter = new BlurFilter(bBlurX, bBlurY);			viewportLayerForCube.filters = [glowFilter, blurFilter];			if( (!isDragging) || (onSliders) ) {				motionDO3D();			}			renderer.renderScene(scene, camera, viewport);			getFPS();		}				private function onStageResizeHandler(event:Event):void {			stageW = stage.stageWidth;			stageH = stage.stageHeight;			vpX = stageW / 2;			vpY = stageH / 2;			cameraInfo.x = stageW;			cameraInfo.y = stageH;		}				private function motionDO3D():void {			container.yaw(-2);		}				private function onMouseDownHandler(event:MouseEvent):void {			isDragging = true;			mouseDownX = mouseX;			mouseDownY = mouseY;		}				private function onMouseMoveHandler(event:MouseEvent):void {			if(!onSliders) {				var X:Number = (mouseX - mouseDownX) * 0.5;				var Y:Number = (mouseY - mouseDownY) * 0.5;				if(isDragging) {					cameraPitch -= Y;					cameraYaw -= X;					cameraPitch %= 360;					cameraYaw %= 360;					if(cameraPitch <= 0) {						cameraPitch = 0.1;					} else if(cameraPitch >= 180) {						cameraPitch = 179.9					}					camera.orbit(cameraPitch, cameraYaw, true, camera.target);					mouseDownX = mouseX;					mouseDownY = mouseY;				}			}		}				private function onMouseUpHandler(event:MouseEvent):void {			isDragging = false;		}				private function onMouseOverSliders(event:MouseEvent):void {			onSliders = true;		}				private function onMouseOutSliders(event:MouseEvent):void {			onSliders = false;		}				private function myGlowColorPickerChangeHandler(event:ColorPickerEvent):void {			gColor = event.color;			gColorHex = "0x" + event.target.hexValue;		}				private function myGlowAlphaSliderDragHandler(event:SliderEvent):void {			gAlpha = myGlowAlphaSlider.value;		}				private function myGlowBlurXSliderDragHandler(event:SliderEvent):void {			gBlurX = myGlowBlurXSlider.value;		}				private function myGlowBlurYSliderDragHandler(event:SliderEvent):void {			gBlurY = myGlowBlurYSlider.value;		}				private function myGlowStrengthSliderDragHandler(event:SliderEvent):void {			gStrength = myGlowStrengthSlider.value;		}				private function myBlurBlurXSliderDragHandler(event:SliderEvent):void {			bBlurX = myBlurBlurXSlider.value;		}				private function myBlurBlurYSliderDragHandler(event:SliderEvent):void {			bBlurY = myBlurBlurYSlider.value;		}	}}