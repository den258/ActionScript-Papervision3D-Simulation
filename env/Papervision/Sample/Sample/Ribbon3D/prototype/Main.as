package {	import flash.display.*;	import flash.events.*;	import flash.utils.*;	import flash.filters.*;		import org.papervision3d.scenes.Scene3D;	import org.papervision3d.objects.DisplayObject3D;	import org.papervision3d.objects.primitives.*;	import org.papervision3d.cameras.*;	import org.papervision3d.view.Viewport3D;	import org.papervision3d.render.BasicRenderEngine;	import org.papervision3d.materials.*;	import org.papervision3d.materials.utils.MaterialsList;	import org.papervision3d.lights.PointLight3D;	import org.papervision3d.materials.shadematerials.*;		import caurina.transitions.*;	import caurina.transitions.properties.*;	import soulwire.papervision3d.Ribbon3D;		[SWF(width="1024", height="568", backgroundColor="#CCCCCC", frameRate="50")]	public class Main extends Sprite {			private var scene:Scene3D;		private var camera:Camera3D;		private var viewport:Viewport3D;		private var renderer:BasicRenderEngine;		private var light:PointLight3D;		private var container:DisplayObject3D;				private var cameraFollowTarget:DisplayObject3D;		private var cameraLookAtTarget:DisplayObject3D;		private var cameraLookAtTargetStation:DisplayObject3D;		private var satellites:Array = new Array();				private var cageSize:int = 500;		private var easing:Number = 0.01;		private var ribbonWidth:Number = 10;		private var ribbonLength:Number = 200;		private var ribbons:Array = new Array();				private var stageW:Number;		private var stageH:Number;		private var vpX:Number;		private var vpY:Number;				private var cameraInfo:CameraInfo;			private var time:Number = 0;		private var secondTime:Number = 0;		private var previousSecondTime:Number = 0;		private var frameNum:Number = 0;		private var fps:String = "...";				public function Main () {						init();		}			private function init():void {			CurveModifiers.init();			setStage();			setScene();			setLight();			setCamera();			setDO3D();			setCameraInfo();						addEventListener(Event.ENTER_FRAME, onEnterFrameHandler);			stage.addEventListener(Event.RESIZE, onStageResizeHandler);		}				private function setStage():void {			stage.quality = StageQuality.MEDIUM;			stage.scaleMode = StageScaleMode.NO_SCALE;			stage.align = StageAlign.TOP_LEFT;			stageW = stage.stageWidth;			stageH = stage.stageHeight;			vpX = stageW / 2;			vpY = stageH / 2;		}				private function setCameraInfo():void {			cameraInfo = new CameraInfo();			addChild(cameraInfo);			stageW = stage.stageWidth;			stageH = stage.stageHeight;			vpX = stageW / 2;			vpY = stageH / 2;			cameraInfo.x = stageW;			cameraInfo.y = stageH;		}				private function setLight():void {			light = new PointLight3D(true);			light.x = 0;			light.y = 500;			light.z = -500;			scene.addChild(light);		}				private function setScene():void{			renderer = new BasicRenderEngine();			scene = new Scene3D();			viewport  = new Viewport3D(stageW, stageH, true, true);			addChild(viewport);		}				private function setCamera():void {			camera = new Camera3D();			camera.x = 0;			camera.y = 3000;			camera.z = -6000;			camera.zoom = 30;			camera.focus = 30;		}				private function setDO3D():void {			container = new DisplayObject3D();			scene.addChild(container);						var material:WireframeMaterial = new WireframeMaterial(0x666666, 1);			var materialList:MaterialsList = new MaterialsList({all: material});			material.oneSide = false;			var cage:Cube = new Cube(materialList, cageSize * 2, cageSize * 2, cageSize * 2, 4, 4, 4);			container.addChild(cage);						var ribbonMaterial:FlatShadeMaterial = new FlatShadeMaterial(light, 0xEF2A82, 0x44031F);			ribbonMaterial.oneSide = false;			var ribbon:Ribbon3D = new Ribbon3D(ribbonMaterial, ribbonWidth, ribbonLength);			container.addChild(ribbon);			ribbon.x = randomNumber(-cageSize, cageSize);			ribbon.y = randomNumber(-cageSize, cageSize);			ribbon.z = randomNumber(-cageSize, cageSize);			ribbons.push(ribbon);						var satellite:DisplayObject3D = new DisplayObject3D();			satellites.push(satellite);			var yellow:ColorMaterial = new ColorMaterial(0xFFFF00, 1);			yellow.oneSide = false;			var yellowPlane:Plane = new Plane(yellow, 20, 20, 1, 1);			satellite.addChild(yellowPlane);			container.addChild(satellite);			tweenObject(satellite);						cameraFollowTarget = new DisplayObject3D();			var red:ColorMaterial = new ColorMaterial(0xFF0000, 1);			red.oneSide = false;			var redPlane:Plane = new Plane(red, 20, 20, 1, 1);			cameraFollowTarget.addChild(redPlane);			container.addChild(cameraFollowTarget);			tweenObject(cameraFollowTarget);							cameraLookAtTarget = new DisplayObject3D();			var green:ColorMaterial = new ColorMaterial(0x00FF00, 1);			green.oneSide = false;			var greenPlane:Plane = new Plane(green, 20, 20, 1, 1);			cameraLookAtTarget.addChild(greenPlane);			container.addChild(cameraLookAtTarget);						cameraLookAtTargetStation = satellite;			container.addChild(cameraLookAtTargetStation);		}				private function getFPS():void {			time = getTimer();			secondTime = time - previousSecondTime;			if(secondTime >= 1000) {				fps = frameNum.toString();				frameNum = 0;				previousSecondTime = time;			} else {				frameNum++;			}			cameraInfo.fpsText.text = fps+"FPS";			cameraInfo.cameraX.text = camera.x.toString();			cameraInfo.cameraY.text = camera.y.toString();			cameraInfo.cameraZ.text = camera.z.toString();		}			private function onEnterFrameHandler(event:Event):void {			motionDO3D();			motionCamera();			renderer.renderScene(scene, camera, viewport);			getFPS();		}				private function onStageResizeHandler(event:Event):void {			stageW = stage.stageWidth;			stageH = stage.stageHeight;			vpX = stageW / 2;			vpY = stageH / 2;			cameraInfo.x = stageW;			cameraInfo.y = stageH;		}				private function motionDO3D():void {			var i:int;			for (i = 0; i < ribbons.length; i++) {				ribbons[i].x += (satellites[i].x - ribbons[i].x) * easing;				ribbons[i].y += (satellites[i].y - ribbons[i].y) * easing;				ribbons[i].z += (satellites[i].z - ribbons[i].z) * easing;				ribbons[i].draw();			}		}				private function motionCamera():void {			cameraLookAtTarget.x += (cameraLookAtTargetStation.x - cameraLookAtTarget.x) * easing;			cameraLookAtTarget.y += (cameraLookAtTargetStation.y - cameraLookAtTarget.y) * easing;			cameraLookAtTarget.z += (cameraLookAtTargetStation.z - cameraLookAtTarget.z) * easing;						camera.x += (cameraFollowTarget.x - camera.x) * easing;			camera.y += (cameraFollowTarget.y - camera.y) * easing;			camera.z += (cameraFollowTarget.z - camera.z) * easing;						var distanceV:Number = camera.distanceTo(cameraLookAtTargetStation) / cageSize;			var focusV:Number = distanceV * 20;						camera.focus += (focusV - camera.focus ) * easing;			camera.lookAt(cameraLookAtTarget);		}				private function tweenObject(object:*):void {			Tweener.addTween(object, {				x:					randomNumber(-cageSize, cageSize),				y:					randomNumber(-cageSize, cageSize),				z:					randomNumber(-cageSize, cageSize),				_bezier:[{					x:				randomNumber(-cageSize, cageSize),					y:				randomNumber(-cageSize, cageSize),					z:				randomNumber(-cageSize, cageSize)				}],				time:				4, 				onComplete:			tweenObject,				onCompleteParams:	[object],				transition:			"linear"			});		}				private function randomNumber(min:Number, max:Number = NaN):Number {			if (isNaN(max)) {				max = min;				min = 0; 			}			return Math.random() * (max - min) + min;		}	}}