package {	import flash.display.*;	import flash.events.*;	import flash.utils.*;	import flash.text.*;		import org.papervision3d.scenes.Scene3D;	import org.papervision3d.objects.DisplayObject3D;	import org.papervision3d.objects.primitives.*;	import org.papervision3d.cameras.*;	import org.papervision3d.view.Viewport3D;	import org.papervision3d.render.BasicRenderEngine;	import org.papervision3d.materials.*;	import org.papervision3d.events.*;	[SWF(width="1024", height="568", backgroundColor="#CCCCCC", frameRate="50")]	public class Main extends Sprite {			private var scene:Scene3D;		private var camera:Camera3D;		private var viewport:Viewport3D;		private var renderer:BasicRenderEngine;				private var plane:Plane;		private var material:BitmapFileMaterial;		private var imgFile:String = "img.jpg";				private var stageW:Number;		private var stageH:Number;		private var vpX:Number;		private var vpY:Number;				private var cameraInfo:CameraInfo;			private var time:Number = 0;		private var secondTime:Number = 0;		private var previousSecondTime:Number = 0;		private var frameNum:Number = 0;		private var fps:String = "...";				public function Main () {						init();		}			private function init():void {			setStage();			setScene();			setCamera();			setDO3D();			setCameraInfo();						stage.addEventListener(Event.RESIZE, onStageResizeHandler);		}				private function setStage():void {			stage.quality = StageQuality.MEDIUM;			stage.scaleMode = StageScaleMode.NO_SCALE;			stage.align = StageAlign.TOP_LEFT;			stageW = stage.stageWidth;			stageH = stage.stageHeight;			vpX = stageW / 2;			vpY = stageH / 2;		}				private function setCameraInfo():void {			cameraInfo = new CameraInfo();			addChild(cameraInfo);			stageW = stage.stageWidth;			stageH = stage.stageHeight;			vpX = stageW / 2;			vpY = stageH / 2;			cameraInfo.x = stageW;			cameraInfo.y = stageH;		}				private function setScene():void{			renderer = new BasicRenderEngine();			scene = new Scene3D();			viewport  = new Viewport3D(0, 0, true, true);			addChild(viewport);		}				private function setCamera():void {			camera = new Camera3D();			camera.x = 0;			camera.y = 100;			camera.z = -600;			camera.zoom = 30;			camera.focus = 30;			camera.target = DisplayObject3D.ZERO;		}				private function setDO3D():void {			material = new BitmapFileMaterial(imgFile, true);			material.oneSide = false;			material.smooth = true;						material.addEventListener(FileLoadEvent.LOAD_COMPLETE, onCompleteHandler);			material.addEventListener(FileLoadEvent.LOAD_ERROR, onErrorHandler);			material.addEventListener(FileLoadEvent.LOAD_PROGRESS, onProgressHandler);						plane = new Plane(material, 480, 360, 6, 6);		}				private function getFPS():void {			time = getTimer();			secondTime = time - previousSecondTime;			if(secondTime >= 1000) {				fps = frameNum.toString();				frameNum = 0;				previousSecondTime = time;			} else {				frameNum++;			}			cameraInfo.fpsText.text = fps+"FPS";			cameraInfo.cameraX.text = camera.x.toString();			cameraInfo.cameraY.text = camera.y.toString();			cameraInfo.cameraZ.text = camera.z.toString();		}				private function moveCameraX(angleX:Number):void {			var cosX:Number = Math.cos(angleX);			var sinX:Number = Math.sin(angleX);			camera.x = camera.x * cosX - camera.z * sinX;		}				private function moveCameraY(angleY:Number):void {			var cosY:Number = Math.cos(angleY);			var sinY:Number = Math.sin(angleY);			camera.y = camera.y * cosY - camera.z * sinY;		}			private function onEnterFrameHandler(event:Event):void {			var angleX:Number = (mouseX - vpX) * 0.0001;			var angleY:Number = (mouseY - vpY) * 0.0001;			moveCameraX(angleX);			moveCameraY(angleY);			renderer.renderScene(scene, camera, viewport);			getFPS();		}				private function onStageResizeHandler(event:Event):void {			stageW = stage.stageWidth;			stageH = stage.stageHeight;			vpX = stageW / 2;			vpY = stageH / 2;			cameraInfo.x = stageW;			cameraInfo.y = stageH;		}				private function onCompleteHandler(event:FileLoadEvent):void {			trace("onComplete!");			// --- 読み込みが正常に完了した場合の処理 --- //			scene.addChild(plane);			addEventListener(Event.ENTER_FRAME, onEnterFrameHandler);						material.removeEventListener(FileLoadEvent.LOAD_COMPLETE, onCompleteHandler);			material.removeEventListener(FileLoadEvent.LOAD_ERROR, onErrorHandler);			material.removeEventListener(FileLoadEvent.LOAD_PROGRESS, onProgressHandler);		}				private function onErrorHandler(event:FileLoadEvent):void {			trace("onError!");			trace("event.message = " + event.message);			// --- 読み込みに失敗した場合の処理 --- //			var tf:TextField = new TextField();			var textFormat:TextFormat = new TextFormat();			textFormat.color = 0x000000;			textFormat.size = 16;			textFormat.font = "_ゴシック";			tf.text = "指定したファイルの読み込みに失敗しました。";			tf.selectable = false;			tf.autoSize = TextFieldAutoSize.LEFT;			tf.x = vpX - tf.width / 2;			tf.y = vpY - tf.height / 2;			tf.setTextFormat(textFormat);			addChild(tf);		}				private function onProgressHandler(event:FileLoadEvent):void {			trace("event.bytesLoaded = " + event.bytesLoaded);			trace("event.bytesTotal = " + event.bytesTotal);		}	}}